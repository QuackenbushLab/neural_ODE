score_summary[, gene:= gsub("_input","",gene)]
score_sd <- score_summary[, sd(pert_score)]
genes_to_print <- score_summary[pert_score > 2*score_sd,][order(-pert_score), gene]
print(score_summary[gene %in% genes_to_print,][order(-pert_score), ])
score_matrix <-  read.csv(write_directory)
row.names(score_matrix) <- score_matrix$X
score_matrix <- score_matrix[,-1]
print("")
print("top-most influential genes (2 SDs away) are:")
score_summary <- data.table(gene = genes_in_dataset, pert_score = rowMedians(as.matrix(score_matrix)))
score_summary[,input_gene := grepl("_input",gene)]
score_summary[, gene:= gsub("_input","",gene)]
score_summary <- merge(score_summary,
true_nums,
by.x = "gene",
by.y = "reg")
score_summary <-merge(score_summary,
harmonic_cent,
by = "gene")
score_sd <- score_summary[, sd(pert_score)]
genes_to_print <- score_summary[pert_score > 2*score_sd,][order(-pert_score), gene]
print(score_summary[gene %in% genes_to_print,][order(-pert_score), ])
print(score_summary[gene %in% genes_to_print,
.(gene, input_gene, pert_score,
true_out, out_cent)][order(-pert_score), ])
print(score_summary[gene %in% genes_to_print,
.(gene, input_gene, pert_score,
out_degree = out_cent,
harmonic_cent = true_out)][order(-pert_score), ])
print(score_summary[gene %in% genes_to_print,
.(gene, input_gene, pert_score,
harmonic_cent = true_out,
out_degree = out_cent)][order(-pert_score), ])
score_matrix <-  read.csv(write_directory)
row.names(score_matrix) <- score_matrix$X
score_matrix <- score_matrix[,-1]
print("")
print("top-most influential genes (2 SDs away) are:")
score_summary <- data.table(gene = genes_in_dataset, pert_score = rowMedians(as.matrix(score_matrix)))
score_summary[,input_gene := grepl("_input",gene)]
score_summary[, gene:= gsub("_input","",gene)]
score_summary <- merge(score_summary,
true_nums,
by.x = "gene",
by.y = "reg")
score_summary <-merge(score_summary,
harmonic_cent,
by = "gene")
score_sd <- score_summary[, sd(pert_score)]
genes_to_print <- score_summary[pert_score > 2*score_sd,][order(-pert_score), gene]
print(score_summary[gene %in% genes_to_print,
.(gene, input_gene, pert_score,
harmonic_cent = true_out,
out_degree = out_cent)][order(-pert_score), ])
score_summary[input_gene == T,
.(gene, input_gene, pert_score,
harmonic_cent = true_out,
out_degree = out_cent)][order(-pert_score), ]
score_summary[input_gene == T,
.(gene, input_gene, pert_score,
harmonic_cent = true_out,
out_degree = out_cent)][order(-pert_score), ][1:10]
print(score_summary[gene %in% genes_to_print,
.(gene, input_gene, pert_score,
harmonic_cent = out_cent,
out_degree = true_out)][order(-pert_score), ])
print(score_summary[gene %in% genes_to_print,
.(gene, input_gene, pert_score,
harmonic_cent = out_cent,
out_degree = true_out)][order(-pert_score), ])
score_summary[input_gene == T,
.(gene, input_gene, pert_score,
harmonic_cent = out_cent,
out_degree = true_out)][order(-pert_score), ][1:10]
score_summary[input_gene == F,
.(gene, input_gene, pert_score,
harmonic_cent = out_cent,
out_degree = true_out)][order(-pert_score), ][1:10]
true_edges[aff== "ROX1"]
score_summary[input_gene == F,
.(gene, input_gene, pert_score,
harmonic_cent = out_in_cent,
out_degree = true_out)][order(-pert_score), ][1:10]
print(score_summary[gene %in% genes_to_print,
.(gene, input_gene, pert_score,
harmonic_cent = out_cent,
out_degree = true_out)][order(-pert_score), ])
score_summary[,.(mean_score = mean(pert_score),
sd_score = sd(pert_score),
corr_out_degree =  cor(true_out, pert_score),
corr_harmonic_cent = cor(out_cent, pert_score)),
by = input_gene]
score_summary[,.(mean_score = mean(pert_score),
sd_score = sd(pert_score),
corr_out_degree =  cor(true_out, pert_score),
corr_harmonic_cent = cor(out_in_cent, pert_score)),
by = input_gene]
score_summary[,.(mean_score = mean(pert_score),
sd_score = sd(pert_score),
corr_out_degree =  cor(true_out, pert_score),
corr_harmonic_cent = cor(out_in_cent, pert_score)),
by = input_gene]
score_summary[,.(mean_score = mean(pert_score),
sd_score = sd(pert_score),
corr_out_degree =  cor(true_out, pert_score),
corr_harmonic_cent = cor(out_cent, pert_score)),
by = input_gene]
score_summary[,.(mean_score = mean(pert_score),
sd_score = sd(pert_score),
corr_out_degree =  cor(true_out, pert_score, type = "spearman"),
corr_harmonic_cent = cor(out_cent, pert_score, type = "spearman")),
by = input_gene]
score_summary[,.(mean_score = mean(pert_score),
sd_score = sd(pert_score),
corr_out_degree =  cor(true_out, pert_score, method = "spearman"),
corr_harmonic_cent = cor(out_cent, pert_score, method = "spearman")),
by = input_gene]
score_summary[,.(mean_score = mean(pert_score),
sd_score = sd(pert_score),
corr_out_degree =  cor(true_out, pert_score, method = "pearson"),
corr_harmonic_cent = cor(out_cent, pert_score, method = "pearson")),
by = input_gene]
spearman
score_summary[,.(mean_score = mean(pert_score),
sd_score = sd(pert_score),
corr_out_degree =  cor(true_out, pert_score, method = "spearman"),
corr_harmonic_cent = cor(out_cent, pert_score, method = "spearman")),
by = input_gene]
score_summary[,.(mean_score = mean(pert_score),
sd_score = sd(pert_score),
corr_out_degree =  cor(true_out, pert_score, method = "spearman"),
corr_harmonic_cent = cor(out_in_cent, pert_score, method = "spearman")),
by = input_gene]
score_summary[,.(mean_score = mean(pert_score),
sd_score = sd(pert_score),
corr_out_degree =  cor(true_out, pert_score, method = "kendall"),
corr_harmonic_cent = cor(out_in_cent, pert_score, method = "kendall")),
by = input_gene]
score_summary[,.(mean_score = mean(pert_score),
sd_score = sd(pert_score),
corr_out_degree =  cor(true_out, pert_score, method = "kendall"),
corr_harmonic_cent = cor(out_cent, pert_score, method = "kendall")),
by = input_gene]
score_summary[,.(mean_score = mean(pert_score),
sd_score = sd(pert_score),
corr_out_degree =  cor(true_out, pert_score, method = "spearman"),
corr_harmonic_cent = cor(out_cent, pert_score, method = "spearman")),
by = input_gene]
score_summary[,.(mean_score = mean(pert_score),
sd_score = sd(pert_score),
corr_out_degree =  cor(true_out, pert_score, method = "pearson"),
corr_harmonic_cent = cor(out_cent, pert_score, method = "pearson")),
by = input_gene]
score_summary[,.(mean_score = mean(pert_score),
sd_score = sd(pert_score),
corr_out_degree =  cor(true_out, pert_score, method = "pearson"),
corr_harmonic_cent = cor(out_in_cent, pert_score, method = "pearson")),
by = input_gene]
score_summary[,.(mean_score = mean(pert_score),
sd_score = sd(pert_score),
corr_out_degree =  cor(true_out, pert_score, method = "pearson"),
corr_harmonic_cent = cor(out_cent, pert_score, method = "pearson")),
by = input_gene]
score_summary[,plot(out_cent, pert_score )]
score_summary[input_gene == T,plot(out_cent, pert_score )]
score_summary[input_gene == F,plot(out_cent, pert_score )]
score_summary[input_gene == F,plot(out_in_cent, pert_score )]
score_summary[input_gene == F,plot(out_cent, pert_score )]
score_summary[input_gene == F,plot(true_out, pert_score )]
score_summary[input_gene == F,plot(out_cent, pert_score )]
score_summary[,.(mean_score = mean(pert_score),
sd_score = sd(pert_score),
corr_out_degree =  cor(true_out, pert_score, method = "pearson"),
corr_harmonic_cent = cor(out_cent, pert_score, method = "pearson")),
by = input_gene]
print("")
print("Making influence plots")
boxplot_data <- score_matrix[genes_to_print,]
boxplot_data$gene <- row.names(boxplot_data)
boxplot_data <- data.table(boxplot_data)
boxplot_data <- melt(boxplot_data, id.vars = "gene",
measure.vars =  paste("V",1:num_iter, sep = ""),
variable.name = "sim_iter",
value.name = "perturb_score")
ggplot(boxplot_data, aes(x = factor(gene,
levels = genes_to_print),
y = perturb_score)) +
geom_boxplot(fill = "dodgerblue") +
theme_bw() +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
xlab("most influential genes")
genes_to_print
score_matrix <-  read.csv(write_directory)
row.names(score_matrix) <- score_matrix$X
score_matrix <- score_matrix[,-1]
print("")
print("top-most influential genes (2 SDs away) are:")
score_summary <- data.table(gene = genes_in_dataset, pert_score = rowMedians(as.matrix(score_matrix)))
score_summary[,input_gene := grepl("_input",gene)]
score_summary[, gene_short:= gsub("_input","",gene)]
score_summary <- merge(score_summary,
true_nums,
by.x = "gene_short",
by.y = "reg")
score_summary <-merge(score_summary,
harmonic_cent,
by = "gene_short")
score_sd <- score_summary[, sd(pert_score)]
score_summary
score_matrix <-  read.csv(write_directory)
row.names(score_matrix) <- score_matrix$X
score_matrix <- score_matrix[,-1]
print("")
print("top-most influential genes (2 SDs away) are:")
score_summary <- data.table(gene = genes_in_dataset, pert_score = rowMedians(as.matrix(score_matrix)))
score_summary[,input_gene := grepl("_input",gene)]
score_summary[, gene_short:= gsub("_input","",gene)]
score_summary
score_summary <- merge(score_summary,
true_nums,
by.x = "gene_short",
by.y = "reg")
score_summary <-merge(score_summary,
harmonic_cent,
by = "gene_short")
score_matrix <-  read.csv(write_directory)
row.names(score_matrix) <- score_matrix$X
score_matrix <- score_matrix[,-1]
print("")
print("top-most influential genes (2 SDs away) are:")
score_summary <- data.table(gene = genes_in_dataset, pert_score = rowMedians(as.matrix(score_matrix)))
score_summary[,input_gene := grepl("_input",gene)]
score_summary[, gene_short:= gsub("_input","",gene)]
score_summary <- merge(score_summary,
true_nums,
by.x = "gene_short",
by.y = "reg")
score_summary <-merge(score_summary,
harmonic_cent,
by.x = "gene_short",
by.y = "gene")
score_sd <- score_summary[, sd(pert_score)]
genes_to_print <- score_summary[pert_score > 2*score_sd,][order(-pert_score), gene]
print(score_summary[gene %in% genes_to_print,
.(gene, pert_score,
harmonic_cent = out_cent,
out_degree = true_out)][order(-pert_score), ])
print("")
print("influence breakdown by input gene:")
score_summary[,.(mean_score = mean(pert_score),
sd_score = sd(pert_score),
corr_out_degree =  cor(true_out, pert_score, method = "pearson"),
corr_harmonic_cent = cor(out_cent, pert_score, method = "pearson")),
by = input_gene]
print("")
print("Making influence plots")
boxplot_data <- score_matrix[genes_to_print,]
boxplot_data$gene <- row.names(boxplot_data)
boxplot_data <- data.table(boxplot_data)
boxplot_data <- melt(boxplot_data, id.vars = "gene",
measure.vars =  paste("V",1:num_iter, sep = ""),
variable.name = "sim_iter",
value.name = "perturb_score")
ggplot(boxplot_data, aes(x = factor(gene,
levels = genes_to_print),
y = perturb_score)) +
geom_boxplot(fill = "dodgerblue") +
theme_bw() +
theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
xlab("most influential genes")
score_matrix["UME6"]
score_matrix
score_matrix["UME6",]
score_matrix["UME6_inpu",]
score_matrix["UME6_input",]
which(score_matrix["UME6_input",] < 10)
score_matrix["UME6_input","V34"]
score_matrix[,"V34"]
hist(score_matrix[,"V34"] )
which(score_matrix[,"V34"] > 100)
row.names(score_matrix)
row.names(score_matrix)[which(score_matrix[,"V34"] > 100)]
print(score_summary[gene %in% genes_to_print,
.(gene, pert_score,
harmonic_cent = out_cent,
out_degree = true_out)][order(-pert_score), ])
row.names(score_matrix)[which(score_matrix[,"V34"] > 100)]
score_matrix["UME6",]
data.table(UME_6 = score_matrix["UME6_input",], REB_1 = score_matrix["REB1_input",])
data.table(UME_6 = score_matrix["UME6_input",],
REB_1 = score_matrix["REB1_input",])
data.table(UME_6 = as.vector(score_matrix["UME6_input",]),
REB_1 = as.vector(score_matrix["REB1_input",]) )
data.table(UME_6 = as.vector(score_matrix["UME6_input",]))
score_matrix["UME6",]
as.numeric(score_matrix["UME6",])
data.table(UME_6 = as.numeric(score_matrix["UME6_input",]),
REB_1 = as.numeric(score_matrix["REB1_input",]) )
X = data.table(UME_6 = as.numeric(score_matrix["UME6_input",]),
REB_1 = as.numeric(score_matrix["REB1_input",]) )
X[34,]
X[,plot(UME_6, REB_1)]
X = data.table(UME_6 = as.numeric(score_matrix["UME6_input",]),
ABF_1 = as.numeric(score_matrix["ABF1_input",]) )
X
X[,plot(UME_6, ABF_1)]
X[,cor(UME_6, ABF_1)]
X = data.table(UME_6 = as.numeric(score_matrix["UME6_input",]),
REB_1 = as.numeric(score_matrix["REB1_input",]) )
X[,cor(UME_6, REB_1)]
true_edges[reg == "UME6_input"]
true_edges[reg == "UME6"]
true_edges[reg == "UME6", aff]
true_edges[reg == "ABF1", aff]
overlap_finder <- function(x, y){intersect(true_edges[reg == x, aff],true_edges[reg == y, aff])}
overlap_finder("UME6","REB1")
overlap_finder("UME6","ABF1")
overlap_finder("UME6","TUP1")
row.names(score_matrix)[which(score_matrix[,"V34"] > 100)]
overlap_finder("UME6","ABF1")
overlap_finder("UME6","GLN3")
overlap_finder("UME6","REB1")
overlap_finder("UME6","TUP1")
score_matrix[which(score_matrix[,"V34"] > 100)
]
which(score_matrix[,"V34"] > 100)
score_matrix[34, c(1,21,39,64)]
score_matrix[c(1,21,39,64), 34]
row.names(score_matrix)[which(score_matrix[,"V34"] > 100)]
overlap_finder("UME6","REB1")
score_summary[,.(mean_score = mean(pert_score),
sd_score = sd(pert_score),
corr_out_degree =  cor(true_out, pert_score, method = "pearson"),
corr_harmonic_cent = cor(out_cent, pert_score, method = "pearson")),
by = input_gene]
#chief_directory <- "/home/ubuntu/neural_ODE/master_regulators/"
chief_directory <- "C:/STUDIES/RESEARCH/neural_ODE/hindcasting/"
img_directory <- paste(chief_directory,"plots/inflential_genes_destination.png", sep = "/")
img_directory_2 <- paste(chief_directory,"plots/central_metrics_destination.png", sep = "/")
wo_prods <- fread(paste(chief_directory,"model_to_test/wo_prods.csv", sep = "/"))
bo_prods <- fread(paste(chief_directory,"model_to_test/bo_prods.csv", sep = "/"))
wo_sums <- fread(paste(chief_directory,"model_to_test/wo_sums.csv", sep = "/"))
bo_sums <- fread(paste(chief_directory,"model_to_test/bo_prods.csv", sep = "/"))
alpha_comb <- fread(paste(chief_directory,"model_to_test/alpha_comb.csv", sep = "/"))
gene_mult <- fread(paste(chief_directory,"model_to_test/gene_mult.csv", sep = "/"))
gene_names <- fread(paste(chief_directory,"model_to_test/gene_names.csv", sep = "/"))
library(data.table)
library(ggplot2)
library(matrixStats)
wo_prods <- fread(paste(chief_directory,"model_to_test/wo_prods.csv", sep = "/"))
bo_prods <- fread(paste(chief_directory,"model_to_test/bo_prods.csv", sep = "/"))
wo_sums <- fread(paste(chief_directory,"model_to_test/wo_sums.csv", sep = "/"))
bo_sums <- fread(paste(chief_directory,"model_to_test/bo_prods.csv", sep = "/"))
alpha_comb <- fread(paste(chief_directory,"model_to_test/alpha_comb.csv", sep = "/"))
gene_mult <- fread(paste(chief_directory,"model_to_test/gene_mult.csv", sep = "/"))
gene_names <- fread(paste(chief_directory,"model_to_test/gene_names.csv", sep = "/"))
soft_sign_mod <- function(x){
shift_x <- x - 0.5
abs_shift_x <- abs(x)
ss_mod <- shift_x/(1+ abs_shift_x)
return(ss_mod)
}
log_soft_sign_mod <- function(x){
shift_x <- x - 0.5
abs_shift_x <- abs(x)
ss_mod <- shift_x/(1+ abs_shift_x)
return(log(1 + ss_mod))
}
my_neural_ode <- function(t, y, parms = NULL,...){
y_soft_sign <- soft_sign_mod(y)
y_log_soft_sign <- log_soft_sign_mod(y)
sums_part <- t(y_soft_sign%*%as.matrix(wo_sums)) + bo_sums
prods_part <- exp(t(y_log_soft_sign%*%as.matrix(wo_prods)) + bo_prods)
concat <- rbind(sums_part, prods_part)
joint = t(as.matrix(alpha_comb)) %*% as.matrix(concat)
final <- gene_mult*(joint - y)
return(list(final$V1))
}
num_genes <- dim(wo_prods)[1]
num_genes
baseline_init_val <- runif(num_genes, min = 0.1, max = 0.9)
baseline_init_val
names(baseline_init_val) <- genes_in_dataset
genes_in_dataset <- gene_names$x
names(baseline_init_val) <- genes_in_dataset
soln_step_by_step <- deSolve::ode(y = baseline_init_val,
times = 0:10,
func = my_neural_ode)
soln_step_by_step[1:5, 1:5]
soln_step_by_step[1:5, 1:7]
soln_step_by_step[1:5, 71:81]
soln_step_by_step[1:5, 75:80]
class(soln_step_by_step)
soln_step_by_step
soln_step_by_step$time
soln_step_by_step[,1]
soln_step_by_step[11,]
soln_step_by_step[11,2:351]
final_steps <- soln_step_by_step[11,2:351]
soln_one_step <- deSolve::ode(y = baseline_init_val,
times = c(0,10),
func = my_neural_ode)
soln_one_step
final_one_step <- soln_one_step[11,2:351]
final_one_step <- soln_one_step[2,2:351]
plot(final_one_step, final_steps)
baseline_init_val <- runif(num_genes, min = 0.1, max = 0.9)
names(baseline_init_val) <- genes_in_dataset
soln_step_by_step <- deSolve::ode(y = baseline_init_val,
times = 0:20,
func = my_neural_ode)
final_steps <- soln_step_by_step[21,2:351]
soln_one_step <- deSolve::ode(y = baseline_init_val,
times = c(0,20),
func = my_neural_ode)
final_one_step <- soln_one_step[2,2:351]
plot(final_one_step, final_steps)
for(i in 1:15){
baseline_init_val <- runif(num_genes, min = 0.1, max = 0.9)
names(baseline_init_val) <- genes_in_dataset
soln_step_by_step <- deSolve::ode(y = baseline_init_val,
times = 0:10,
func = my_neural_ode)
final_steps <- soln_step_by_step[11,2:351]
soln_one_step <- deSolve::ode(y = baseline_init_val,
times = c(0,10),
func = my_neural_ode)
final_one_step <- soln_one_step[2,2:351]
print(paste("iter", i,
"cor is", cor(final_one_step, final_steps)))
}
target_val <- runif(num_genes, min = 0.1, max = 0.9)
names(target_val) <- genes_in_dataset
soln_one_step <- deSolve::ode(y = target_val,
times = c(10,0),
func = my_neural_ode)
target_val <- runif(num_genes, min = 0.1, max = 0.9)
names(target_val) <- genes_in_dataset
target_val
final_one_step
plot(final_one_step, target_val)
target_val <- final_one_step
names(target_val) <- genes_in_dataset
soln_one_step <- deSolve::ode(y = target_val,
times = c(10,0),
func = my_neural_ode)
init_one_step <- soln_one_step[2,2:351]
init_one_step
final_using_init <- (deSolve::ode(y = target_val,
times = c(0,10),
func = my_neural_ode))[2,2:351]
plot(target_val, final_using_init)
hist(init_one_step)
init_one_step_fixed <- (init_one_step- mean(init_one_step))/sd(init_one_step)
hist(init_one_step_fixed)
init_one_step <- soln_one_step[2,2:351]
hist(init_o)
hist(init_one_step)
#init_one_step_fixed <- (init_one_step- mean(init_one_step))/sd(init_one_step)
final_using_init <- (deSolve::ode(y = init_one_step,
times = c(0,10),
func = my_neural_ode))[2,2:351]
plot(target_val, final_using_init)
init_one_step_fixed <- (init_one_step- mean(init_one_step))/sd(init_one_step)
final_using_init <- (deSolve::ode(y = init_one_step_fixed,
times = c(0,10),
func = my_neural_ode))[2,2:351]
plot(target_val, final_using_init)
init_one_step <- soln_one_step[2,2:351]
init_one_step <- ifelse(init_one_step < 0, 0.001, init_one_step)
init_one_step <- ifelse(init_one_step > 1, 1-0.001, init_one_step)
hist(init_one_step)
final_using_init <- (deSolve::ode(y = init_one_step,
times = c(0,10),
func = my_neural_ode))[2,2:351]
plot(target_val, final_using_init)
hist(init_one_step)
init_one_step <- soln_one_step[2,2:351]
init_one_step <- ifelse(init_one_step < 0, 0.001, init_one_step)
init_one_step <- ifelse(init_one_step > 1, 1-0.001, init_one_step)
init_one_step <- soln_one_step[2,2:351]
hist(init_one_step)
#FIX IT:
init_one_step <- ifelse(init_one_step < 0, 0.001, init_one_step)
init_one_step <- ifelse(init_one_step > 1, 1-0.001, init_one_step)
final_using_init <- (deSolve::ode(y = init_one_step,
times = c(0,10),
func = my_neural_ode))[2,2:351]
plot(target_val, final_using_init)
target_val <- runif(num_genes, min = 0.1, max = 0.9)
#target_val <- final_one_step
names(target_val) <- genes_in_dataset
soln_one_step <- deSolve::ode(y = target_val,
times = c(10,0),
func = my_neural_ode)
target_val <- runif(num_genes, min = 0.1, max = 0.9)
#target_val <- final_one_step
names(target_val) <- genes_in_dataset
soln_one_step <- deSolve::ode(y = target_val,
times = c(5,0),
func = my_neural_ode)
init_one_step <- soln_one_step[2,2:351]
target_val <- runif(num_genes, min = 0.1, max = 0.9)
#target_val <- final_one_step
names(target_val) <- genes_in_dataset
soln_one_step <- deSolve::ode(y = target_val,
times = c(1,0),
func = my_neural_ode)
soln_one_step <- deSolve::ode(y = target_val,
times = c(1,0),
func = my_neural_ode,
method = "bdf")
